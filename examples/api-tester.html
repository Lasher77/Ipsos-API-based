<!doctype html>
<html lang="de">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>BVMW Segmenter API Tester</title>
    <style>
      :root {
        color-scheme: light;
        font-family: "Segoe UI", Tahoma, sans-serif;
      }
      body {
        margin: 2rem;
        background: #f8f9fb;
        color: #1c1e21;
      }
      h1 {
        margin-bottom: 0.25rem;
      }
      p {
        margin-top: 0;
        color: #50535a;
      }
      .card {
        background: #fff;
        border-radius: 12px;
        box-shadow: 0 8px 24px rgba(17, 18, 20, 0.08);
        padding: 1.5rem;
        margin-bottom: 1.5rem;
      }
      form {
        display: grid;
        gap: 1rem;
      }
      label {
        font-weight: 600;
        display: block;
        margin-bottom: 0.35rem;
      }
      select,
      input[type="text"] {
        width: 100%;
        padding: 0.5rem 0.65rem;
        border-radius: 8px;
        border: 1px solid #cbd2dc;
        background: #fff;
      }
      .grid {
        display: grid;
        gap: 1rem;
        grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
      }
      .actions {
        display: flex;
        flex-wrap: wrap;
        gap: 0.75rem;
        align-items: center;
      }
      button {
        border: none;
        border-radius: 999px;
        padding: 0.55rem 1.4rem;
        font-weight: 600;
        cursor: pointer;
      }
      button.primary {
        background: #2957ff;
        color: #fff;
      }
      button.secondary {
        background: #e2e6f0;
        color: #1c1e21;
      }
      pre {
        background: #0f172a;
        color: #f8fafc;
        padding: 1rem;
        border-radius: 12px;
        overflow-x: auto;
        min-height: 120px;
      }
      .status {
        font-size: 0.9rem;
        color: #6b7280;
      }
      .toggle-group {
        display: flex;
        gap: 1rem;
        flex-wrap: wrap;
      }
      .toggle-group label {
        font-weight: 500;
        display: flex;
        align-items: center;
        gap: 0.35rem;
      }
    </style>
  </head>
  <body>
    <h1>BVMW Segmenter API Tester</h1>
    <p>Einfaches HTML-Formular, um die Segmenter-API lokal zu testen.</p>

    <div class="card">
      <form id="segment-form">
        <div>
          <label for="base-url">API Basis-URL</label>
          <input id="base-url" type="text" value="http://localhost:8000" />
        </div>

        <div class="toggle-group">
          <label>
            <input type="checkbox" id="include-features" checked />
            include_features
          </label>
          <label>
            <input type="checkbox" id="pretty-scores" checked />
            pretty_scores
          </label>
        </div>

        <div class="grid" id="select-grid"></div>

        <div class="actions">
          <button type="submit" class="primary">Segment berechnen</button>
          <button type="button" class="secondary" id="reset">Zurücksetzen</button>
          <span class="status" id="status"></span>
        </div>
      </form>
    </div>

    <div class="card">
      <h2>Response</h2>
      <pre id="response">Noch keine Anfrage gesendet.</pre>
    </div>

    <script>
      const optionsByField = {
        "Anrede": ["Female"],
        "Branche_Oberkategorie": [
          "Baugewerbe",
          "Energieversorgung",
          "Erbringung von Finanz- und Versicherungsdienstleistungen",
          "Erbringung von freiberuflichen, wissenschaftlichen und technischen Dienstleistungen",
          "Erbringung von sonstigen Dienstleistungen",
          "Erbringung von sonstigen wirtschaftlichen Dienstleistungen",
          "Erziehung und Unterricht",
          "Gastgewerbe",
          "Gesundheits- und Sozialwesen",
          "Grundstücks- und Wohnungswesen",
          "Handel; Instandhaltung und Reparatur von Kraftfahrzeugen",
          "Information und Kommunikation",
          "Kunst, Unterhaltung und Erholung",
          "Verarbeitendes Gewerbe",
          "Verkehr und Lagerei",
          "Wasserversorgung; Abwasser- und Abfallentsorgung und Beseitigung von Umweltverschmutzungen",
          "Öffentliche Verwaltung, Verteidigung; Sozialversicherung"
        ],
        "Bundesland": [
          "Baden-Württemberg",
          "Bayern",
          "Berlin",
          "Brandenburg",
          "Bremen",
          "Hamburg",
          "Hessen",
          "Mecklenburg-Vorpommern",
          "Niedersachsen",
          "Nordrhein-Westfalen",
          "Rheinland-Pfalz",
          "Saarland",
          "Sachsen",
          "Sachsen-Anhalt",
          "Schleswig-Holstein",
          "Thüringen"
        ],
        "Gesetzlicher_Vertreter": [
          "Sind Sie in Ihrem Unternehmen (mit-)verantwortlich für Mitgliedschaften in beispielsweise Unternehmens- oder Handelsverbänden, Interessenvertretungen etc.?"
        ],
        "Mitarbeiter oder BD Mitarbeiterstaffel": [
          "1-4",
          "10-24",
          "25-49",
          "250-499",
          "5-9",
          "50-249",
          "500 und mehr"
        ],
        "Mitgliedsdauer_Jahre": [
          "Mitgliedsdauer 2 bis 4 Jahre",
          "Mitgliedsdauer 5 bis 9 Jahre",
          "Mitgliedsdauer bis zu 1 Jahr"
        ],
        "Position": [
          "Assistenz",
          "Bereichsleiter:in",
          "Geschäftsführung / Geschäftsleitung",
          "Inhaber:in",
          "Mitarbeiter:in",
          "Partner:in",
          "Prokurist:in",
          "Vorstand"
        ],
        "Status_ Mitgliedschaft": [
          "Ehemaliges Mitglied Mittelstand. BVMW",
          "Mitglied beim Mittelstand. BVMW",
          "Mitglied in Kündigung beim Mittelstand. BVMW"
        ],
        "Wirtschaftsregion": [
          "BWS",
          "BWS / LWS",
          "Bayern Nord",
          "Bayern Süd",
          "Berlin / Brandenburg Nord",
          "Berlin / Brandenburg Süd-West",
          "Brandenburg Süd-Ost",
          "Bremen Oldenburg",
          "Bundeszentrale",
          "Chemnitz",
          "Dresden",
          "Düsseldorf",
          "Hamburg",
          "Hannover",
          "Köln/-Rhein-Erft-Kreis",
          "Leipzig",
          "Mainfranken",
          "Mecklenburg-Vorpommern",
          "Münsterland / Ostwestfalen-Lippe",
          "NRW Südwest",
          "Niedersachsen West",
          "Nordbaden-Rhein-Neckar",
          "Nordhessen",
          "Rhein-Main",
          "Rheinland-Pfalz",
          "Ruhrgebiet",
          "Ruhrmetropole Ost",
          "Ruhrmetropole West",
          "Saarland",
          "Sachsen-Anhalt",
          "Schleswig-Holstein",
          "Schwarzwald / Bodensee",
          "Südliches Nordrheinwestfalen",
          "Südwestfalen",
          "Thüringen Ost",
          "Thüringen West",
          "Württemberg"
        ]
      };

      const selectGrid = document.getElementById("select-grid");
      const responseEl = document.getElementById("response");
      const statusEl = document.getElementById("status");
      const form = document.getElementById("segment-form");
      const resetButton = document.getElementById("reset");

      function createSelect(field, options) {
        const wrapper = document.createElement("div");
        const label = document.createElement("label");
        label.textContent = field;
        label.setAttribute("for", `field-${field}`);

        const select = document.createElement("select");
        select.id = `field-${field}`;
        select.name = field;

        const emptyOption = document.createElement("option");
        emptyOption.value = "";
        emptyOption.textContent = "-- bitte wählen --";
        select.appendChild(emptyOption);

        options.forEach((value) => {
          const option = document.createElement("option");
          option.value = value;
          option.textContent = value;
          select.appendChild(option);
        });

        wrapper.appendChild(label);
        wrapper.appendChild(select);
        return wrapper;
      }

      function renderSelects() {
        Object.entries(optionsByField).forEach(([field, options]) => {
          selectGrid.appendChild(createSelect(field, options));
        });
      }

      function buildPayload() {
        const payload = {};
        Object.keys(optionsByField).forEach((field) => {
          const select = document.getElementById(`field-${field}`);
          if (select && select.value) {
            payload[field] = select.value;
          }
        });
        return payload;
      }

      async function submitForm(event) {
        event.preventDefault();
        const baseUrl = document.getElementById("base-url").value.trim().replace(/\/$/, "");
        const includeFeatures = document.getElementById("include-features").checked;
        const prettyScores = document.getElementById("pretty-scores").checked;
        const payload = buildPayload();

        if (!Object.keys(payload).length) {
          responseEl.textContent = "Bitte mindestens ein Feld auswählen.";
          return;
        }

        const params = new URLSearchParams();
        if (includeFeatures) params.set("include_features", "true");
        if (prettyScores) params.set("pretty_scores", "true");

        const url = `${baseUrl}/segment?${params.toString()}`;

        statusEl.textContent = "Sende Anfrage ...";
        responseEl.textContent = "";

        try {
          const response = await fetch(url, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(payload, null, 2)
          });
          const data = await response.json();
          responseEl.textContent = JSON.stringify(data, null, 2);
          statusEl.textContent = response.ok
            ? "Antwort erfolgreich empfangen."
            : `Fehler: ${response.status} ${response.statusText}`;
        } catch (error) {
          responseEl.textContent = String(error);
          statusEl.textContent = "Fehler beim Senden der Anfrage.";
        }
      }

      function resetForm() {
        form.reset();
        statusEl.textContent = "";
        responseEl.textContent = "Noch keine Anfrage gesendet.";
      }

      renderSelects();
      form.addEventListener("submit", submitForm);
      resetButton.addEventListener("click", resetForm);
    </script>
  </body>
</html>
