<!doctype html>
<html lang="de">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>BVMW Segmenter API Tester</title>
    <style>
      :root {
        color-scheme: light;
        font-family: "Segoe UI", Tahoma, sans-serif;
      }
      body {
        margin: 2rem;
        background: #f8f9fb;
        color: #1c1e21;
      }
      h1 {
        margin-bottom: 0.25rem;
      }
      p {
        margin-top: 0;
        color: #50535a;
      }
      .card {
        background: #fff;
        border-radius: 12px;
        box-shadow: 0 8px 24px rgba(17, 18, 20, 0.08);
        padding: 1.5rem;
        margin-bottom: 1.5rem;
      }
      form {
        display: grid;
        gap: 1rem;
      }
      label {
        font-weight: 600;
        display: block;
        margin-bottom: 0.35rem;
      }
      select,
      input[type="text"] {
        width: 100%;
        padding: 0.5rem 0.65rem;
        border-radius: 8px;
        border: 1px solid #cbd2dc;
        background: #fff;
      }
      .grid {
        display: grid;
        gap: 1rem;
        grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
      }
      .actions {
        display: flex;
        flex-wrap: wrap;
        gap: 0.75rem;
        align-items: center;
      }
      button {
        border: none;
        border-radius: 999px;
        padding: 0.55rem 1.4rem;
        font-weight: 600;
        cursor: pointer;
      }
      button.primary {
        background: #2957ff;
        color: #fff;
      }
      button.secondary {
        background: #e2e6f0;
        color: #1c1e21;
      }
      pre {
        background: #0f172a;
        color: #f8fafc;
        padding: 1rem;
        border-radius: 12px;
        overflow-x: auto;
        min-height: 120px;
      }
      .status {
        font-size: 0.9rem;
        color: #6b7280;
      }
      .toggle-group {
        display: flex;
        gap: 1rem;
        flex-wrap: wrap;
      }
      .toggle-group label {
        font-weight: 500;
        display: flex;
        align-items: center;
        gap: 0.35rem;
      }
    </style>
  </head>
  <body>
    <h1>BVMW Segmenter API Tester</h1>
    <p>Einfaches HTML-Formular, um die Segmenter-API lokal zu testen (Textwerte oder Codes).</p>

    <div class="card">
      <form id="segment-form">
        <div>
          <label for="base-url">API Basis-URL</label>
          <input id="base-url" type="text" value="http://localhost:8000" />
        </div>

        <div class="toggle-group">
          <label>
            <input type="checkbox" id="include-features" checked />
            include_features
          </label>
          <label>
            <input type="checkbox" id="pretty-scores" checked />
            pretty_scores
          </label>
          <label>
            <input type="checkbox" id="use-codes" />
            Codes statt Textwerte senden
          </label>
        </div>

        <div class="grid" id="select-grid"></div>

        <div class="actions">
          <button type="submit" class="primary">Segment berechnen</button>
          <button type="button" class="secondary" id="reset">Zurücksetzen</button>
          <span class="status" id="status"></span>
        </div>
      </form>
    </div>

    <div class="card">
      <h2>Response</h2>
      <pre id="response">Noch keine Anfrage gesendet.</pre>
    </div>

    <script>
      const fieldConfig = {
        "Anrede": {
          type: "select",
          options: [
            { code: "1", label: "Männlich" },
            { code: "2", label: "Weiblich" },
            { code: "3", label: "Divers" },
            { code: "99", label: "Keine Angabe" }
          ]
        },
        "Branche_Oberkategorie": {
          type: "select",
          options: [
            { code: "1", label: "Erbringung von sonstigen wirtschaftlichen Dienstleistungen" },
            { code: "2", label: "Verarbeitendes Gewerbe" },
            { code: "3", label: "Handel; Instandhaltung und Reparatur von Kraftfahrzeugen" },
            { code: "4", label: "Information und Kommunikation" },
            { code: "5", label: "Grundstücks- und Wohnungswesen" },
            { code: "6", label: "Baugewerbe" },
            { code: "7", label: "Gastgewerbe" },
            { code: "8", label: "Verkehr und Lagerei" },
            { code: "9", label: "Energieversorgung" },
            { code: "10", label: "Erbringung von sonstigen Dienstleistungen" },
            { code: "11", label: "Erbringung von freiberuflichen, wissenschaftlichen und technischen Dienstleistungen" },
            { code: "12", label: "Wasserversorgung; Abwasser- und Abfallentsorgung und Beseitigung von Umweltverschmutzungen" },
            { code: "13", label: "Erbringung von Finanz- und Versicherungsdienstleistungen" },
            { code: "14", label: "Kunst, Unterhaltung und Erholung" },
            { code: "15", label: "Gesundheits- und Sozialwesen" },
            { code: "16", label: "Erziehung und Unterricht" },
            { code: "17", label: "Land- und Forstwirtschaft, Fischerei" },
            { code: "18", label: "Öffentliche Verwaltung, Verteidigung; Sozialversicherung" },
            { code: "19", label: "Exterritoriale Organisationen und Körperschaften" },
            {
              code: "20",
              label:
                "Private Haushalte mit Hauspersonal; Herstellung von Waren und Erbringung von Dienstleistungen durch private Haushalte fü"
            },
            { code: "21", label: "Bergbau und Gewinnung von Steinen und Erden" },
            { code: "98", label: "Sonstige Branche und zwar:" }
          ]
        },
        "Bundesland": {
          type: "select",
          options: [
            { code: "1", label: "Baden-Württemberg" },
            { code: "2", label: "Bayern" },
            { code: "3", label: "Berlin" },
            { code: "4", label: "Brandenburg" },
            { code: "5", label: "Bremen" },
            { code: "6", label: "Hamburg" },
            { code: "7", label: "Hessen" },
            { code: "8", label: "Mecklenburg-Vorpommern" },
            { code: "9", label: "Niedersachsen" },
            { code: "10", label: "Nordrhein-Westfalen" },
            { code: "11", label: "Rheinland-Pfalz" },
            { code: "12", label: "Saarland" },
            { code: "13", label: "Sachsen" },
            { code: "14", label: "Sachsen-Anhalt" },
            { code: "15", label: "Schleswig-Holstein" },
            { code: "16", label: "Thüringen" },
            { code: "91", label: "Ausland" }
          ]
        },
        "Gesetzlicher_Vertreter": {
          type: "select",
          options: [
            { code: "1", label: "ja" },
            { code: "2", label: "nein" }
          ]
        },
        "Mitarbeiter oder BD Mitarbeiterstaffel": {
          type: "select",
          options: [
            { code: "1", label: "1-4" },
            { code: "2", label: "5-9" },
            { code: "3", label: "10-24" },
            { code: "4", label: "25-49" },
            { code: "5", label: "50-249" },
            { code: "6", label: "250-499" },
            { code: "7", label: "500 und mehr" },
            { code: "99", label: "weiß nicht/ keine Angabe" }
          ]
        },
        "Mitgliedsdauer_Jahre": {
          type: "text",
          placeholder: "z.B. 3 oder Mitgliedsdauer 2 bis 4 Jahre"
        },
        "Position": {
          type: "select",
          options: [
            { code: "1", label: "Vorstand" },
            { code: "2", label: "Prokurist:in" },
            { code: "3", label: "Partner:in" },
            { code: "4", label: "Geschäftsführung / Geschäftsleitung" },
            { code: "5", label: "Inhaber:in" },
            { code: "6", label: "Bereichsleiter:in" },
            { code: "7", label: "Mitarbeiter:in" },
            { code: "8", label: "Assistenz" },
            { code: "9", label: "Freie:r Mitarbeiter:in" }
          ]
        },
        "Status_ Mitgliedschaft": {
          type: "select",
          options: [
            { code: "1", label: "Mitglied beim Mittelstand. BVMW" },
            { code: "2", label: "Mitglied in Kündigung beim Mittelstand. BVMW" },
            { code: "3", label: "Ehemaliges Mitglied Mittelstand. BVMW" },
            { code: "4", label: "Interessenten Mittelstand. BVMW" }
          ]
        },
        "Wirtschaftsregion": {
          type: "select",
          options: [
            { code: "1", label: "Bayern Nord" },
            { code: "2", label: "Bayern Süd" },
            { code: "3", label: "Berlin / Brandenburg Nord" },
            { code: "4", label: "Berlin / Brandenburg Süd-West" },
            { code: "5", label: "Brandenburg Süd-Ost" },
            { code: "6", label: "Bremen Oldenburg" },
            { code: "7", label: "Bundeszentrale" },
            { code: "8", label: "BWS" },
            { code: "9", label: "BWS / LWS" },
            { code: "10", label: "Chemnitz" },
            { code: "11", label: "Cottbus, Niederlausitz" },
            { code: "12", label: "Dresden" },
            { code: "13", label: "Düsseldorf" },
            { code: "14", label: "Hamburg" },
            { code: "15", label: "Hannover" },
            { code: "16", label: "Köln/-Rhein-Erft-Kreis" },
            { code: "17", label: "Leipzig" },
            { code: "18", label: "Mainfranken" },
            { code: "19", label: "Mecklenburg-Vorpommern" },
            { code: "20", label: "Münsterland / Ostwestfalen-Lippe" },
            { code: "21", label: "Niedersachsen West" },
            { code: "22", label: "Nordbaden-Rhein-Neckar" },
            { code: "23", label: "Nordhessen" },
            { code: "24", label: "NRW Südwest" },
            { code: "25", label: "Rheinland-Pfalz" },
            { code: "26", label: "Rhein-Main" },
            { code: "27", label: "Ruhrgebiet" },
            { code: "28", label: "Saarland" },
            { code: "29", label: "Sachsen-Anhalt" },
            { code: "30", label: "Schleswig-Holstein" },
            { code: "31", label: "Schwarzwald / Bodensee" },
            { code: "32", label: "Südliches Nordrheinwestfalen" },
            { code: "33", label: "Südwestfalen" },
            { code: "34", label: "Thüringen" },
            { code: "35", label: "Thüringen Ost" },
            { code: "36", label: "Thüringen West" },
            { code: "37", label: "Württemberg" },
            { code: "38", label: "Ruhrmetropole Ost" },
            { code: "39", label: "Ruhrmetropole West" },
            { code: "91", label: "Ausland" }
          ]
        }
      };

      const selectGrid = document.getElementById("select-grid");
      const responseEl = document.getElementById("response");
      const statusEl = document.getElementById("status");
      const form = document.getElementById("segment-form");
      const resetButton = document.getElementById("reset");

      function createSelect(field, options, useCodes, selectedValue) {
        const wrapper = document.createElement("div");
        const label = document.createElement("label");
        label.textContent = field;
        label.setAttribute("for", `field-${field}`);

        const select = document.createElement("select");
        select.id = `field-${field}`;
        select.name = field;

        const emptyOption = document.createElement("option");
        emptyOption.value = "";
        emptyOption.textContent = "-- bitte wählen --";
        select.appendChild(emptyOption);

        options.forEach(({ code, label: optionLabel }) => {
          const option = document.createElement("option");
          option.value = useCodes ? code : optionLabel;
          option.textContent = useCodes ? `${code} – ${optionLabel}` : optionLabel;
          if (selectedValue && option.value === selectedValue) {
            option.selected = true;
          }
          select.appendChild(option);
        });

        wrapper.appendChild(label);
        wrapper.appendChild(select);
        return wrapper;
      }

      function createTextInput(field, placeholder, selectedValue) {
        const wrapper = document.createElement("div");
        const label = document.createElement("label");
        label.textContent = field;
        label.setAttribute("for", `field-${field}`);

        const input = document.createElement("input");
        input.type = "text";
        input.id = `field-${field}`;
        input.name = field;
        input.placeholder = placeholder || "";
        if (selectedValue) {
          input.value = selectedValue;
        }

        wrapper.appendChild(label);
        wrapper.appendChild(input);
        return wrapper;
      }

      function renderSelects(selectedValues = {}) {
        selectGrid.innerHTML = "";
        const useCodes = document.getElementById("use-codes").checked;
        Object.entries(fieldConfig).forEach(([field, config]) => {
          if (config.type === "text") {
            selectGrid.appendChild(
              createTextInput(field, config.placeholder, selectedValues[field])
            );
            return;
          }
          let selectedValue = selectedValues[field];
          if (selectedValue) {
            const matchOption = config.options.find(
              ({ code, label: optionLabel }) =>
                (useCodes && optionLabel === selectedValue) ||
                (!useCodes && code === selectedValue)
            );
            if (matchOption) {
              selectedValue = useCodes ? matchOption.code : matchOption.label;
            }
          }
          selectGrid.appendChild(
            createSelect(field, config.options, useCodes, selectedValue)
          );
        });
      }

      function buildPayload() {
        const payload = {};
        Object.entries(fieldConfig).forEach(([field, config]) => {
          const input = document.getElementById(`field-${field}`);
          if (!input || !input.value) {
            return;
          }
          payload[field] = input.value;
        });
        return payload;
      }

      async function submitForm(event) {
        event.preventDefault();
        const baseUrl = document.getElementById("base-url").value.trim().replace(/\/$/, "");
        const includeFeatures = document.getElementById("include-features").checked;
        const prettyScores = document.getElementById("pretty-scores").checked;
        const payload = buildPayload();

        if (!Object.keys(payload).length) {
          responseEl.textContent = "Bitte mindestens ein Feld auswählen.";
          return;
        }

        const params = new URLSearchParams();
        if (includeFeatures) params.set("include_features", "true");
        if (prettyScores) params.set("pretty_scores", "true");

        const url = `${baseUrl}/segment?${params.toString()}`;

        statusEl.textContent = "Sende Anfrage ...";
        responseEl.textContent = "";

        try {
          const response = await fetch(url, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(payload, null, 2)
          });
          const data = await response.json();
          responseEl.textContent = JSON.stringify(data, null, 2);
          statusEl.textContent = response.ok
            ? "Antwort erfolgreich empfangen."
            : `Fehler: ${response.status} ${response.statusText}`;
        } catch (error) {
          responseEl.textContent = String(error);
          statusEl.textContent = "Fehler beim Senden der Anfrage.";
        }
      }

      function resetForm() {
        form.reset();
        statusEl.textContent = "";
        responseEl.textContent = "Noch keine Anfrage gesendet.";
      }

      const useCodesToggle = document.getElementById("use-codes");

      function handleToggle() {
        const selectedValues = {};
        Object.keys(fieldConfig).forEach((field) => {
          const input = document.getElementById(`field-${field}`);
          if (input && input.value) {
            selectedValues[field] = input.value;
          }
        });
        renderSelects(selectedValues);
      }

      renderSelects();
      form.addEventListener("submit", submitForm);
      resetButton.addEventListener("click", resetForm);
      useCodesToggle.addEventListener("change", handleToggle);
    </script>
  </body>
</html>
